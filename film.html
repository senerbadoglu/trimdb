<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRimdb PRO | Detaylı Film Rehberi</title>
    <style>
        :root { --sari: #f5c518; --siyah: #000; --gri: #1a1a1a; --kutu: #222; }
        body { background: var(--siyah); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; }
        
        /* Header & Filtreler aynı kalıyor */
        header { background: #111; padding: 15px 5%; display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid var(--sari); }
        .logo { font-size: 24px; font-weight: 900; background: var(--sari); color: black; padding: 5px 15px; border-radius: 5px; text-decoration: none; }
        .filtre-alani { background: #111; padding: 20px 5%; border-bottom: 1px solid #333; }
        .filtreler { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .secim-kutusu { background: var(--kutu); padding: 10px; border-radius: 8px; border: 1px solid #444; }
        .secim-kutusu label { display: block; color: var(--sari); font-size: 10px; font-weight: bold; margin-bottom: 5px; }
        .secim-kutusu select { width: 100%; background: transparent; color: white; border: none; outline: none; }
        .btn-bul { background: var(--sari); color: black; width: 100%; border: none; padding: 15px; border-radius: 8px; font-weight: 900; margin-top: 15px; cursor: pointer; }

        /* Film Kartları */
        .film-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 25px; padding: 30px 5%; }
        .film { background: var(--kutu); border-radius: 12px; overflow: hidden; cursor: pointer; transition: 0.3s; position: relative; border: 1px solid #333; }
        .film:hover { transform: scale(1.05); border-color: var(--sari); }
        .film img { width: 100%; height: 270px; object-fit: cover; }
        .puan-badge { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: var(--sari); padding: 5px; border-radius: 5px; font-weight: bold; }

        /* DETAY MODAL (Açılır Pencere) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; overflow-y: auto; padding: 20px 0; }
        .modal-content { background: #111; width: 90%; max-width: 1000px; margin: auto; border-radius: 20px; border: 1px solid var(--sari); display: flex; flex-wrap: wrap; position: relative; overflow: hidden; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 35px; color: white; cursor: pointer; z-index: 11; }
        
        .modal-sol { flex: 1; min-width: 300px; padding: 20px; }
        .modal-sol img { width: 100%; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        .modal-sag { flex: 2; min-width: 300px; padding: 30px; }
        .modal-sag h2 { color: var(--sari); margin-top: 0; font-size: 28px; }
        .film-meta { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .meta-tag { background: #333; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .puanlar { display: flex; gap: 20px; margin: 20px 0; padding: 15px; background: #222; border-radius: 10px; }
        .puan-site { text-align: center; }
        .puan-site small { display: block; color: var(--sari); font-size: 10px; }
        
        .ozet { line-height: 1.6; color: #ccc; margin-bottom: 20px; }
        .detay-liste { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 14px; border-top: 1px solid #333; padding-top: 15px; }
        .detay-liste b { color: var(--sari); }

        .fragman-box { margin-top: 25px; border-radius: 10px; overflow: hidden; background: #000; height: 300px; width: 100%; }
    </style>
</head>
<body>

<header>
    <a href="#" class="logo">TRimdb PRO</a>
    <div id="status" style="font-size: 12px; color: #555;">Tüm veriler aktif</div>
</header>

<div class="filtre-alani">
    <div class="filtreler">
        <div class="secim-kutusu"><label>TÜR</label><select id="tur"><option value="">Tümü</option><option value="28">Aksiyon</option><option value="12">Macera</option><option value="18">Dram</option><option value="35">Komedi</option><option value="27">Korku</option><option value="878">Bilim Kurgu</option></select></div>
        <div class="secim-kutusu"><label>YIL</label><select id="yil"><option value="">Tümü</option><option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option><option value="2020">2020+</option></select></div>
        <div class="secim-kutusu"><label>TRimdb PUANI</label><select id="puan"><option value="0">Tümü</option><option value="8">8+ Üzeri</option><option value="7">7+ Üzeri</option><option value="5">5+ Üzeri</option></select></div>
    </div>
    <button class="btn-bul" onclick="filmleriGetir()">FİLMLERİ TARA</button>
</div>

<div class="film-grid" id="liste"></div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="modalKapat()">&times;</span>
        <div class="modal-sol" id="m-afis"></div>
        <div class="modal-sag">
            <h2 id="m-baslik"></h2>
            <div class="film-meta" id="m-meta"></div>
            
            <div class="puanlar">
                <div class="puan-site"><small>IMDB</small><span id="p-imdb">-</span></div>
                <div class="puan-site"><small>TMDB</small><span id="p-tmdb">-</span></div>
                <div class="puan-site"><small>POPÜLERLİK</small><span id="p-pop">-</span></div>
            </div>

            <p class="ozet" id="m-ozet"></p>

            <div class="detay-liste">
                <div><b>Yönetmen:</b> <span id="d-yonetmen">-</span></div>
                <div><b>Senarist:</b> <span id="d-senaryo">-</span></div>
                <div><b>Oyuncular:</b> <span id="d-oyuncu">-</span></div>
                <div><b>Ülke:</b> <span id="d-ulke">-</span></div>
                <div><b>Şirket:</b> <span id="d-sirket">-</span></div>
                <div><b>Süre:</b> <span id="d-sure">-</span></div>
                <div><b>Bütçe:</b> <span id="d-butce">-</span></div>
                <div><b>Gelir:</b> <span id="d-gelir">-</span></div>
            </div>

            <div class="fragman-box" id="m-video"></div>
        </div>
    </div>
</div>

<script>
    const API_KEY = '5157610ea853936f008717feb19e6a9f';

    async function filmleriGetir() {
        const liste = document.getElementById('liste');
        liste.innerHTML = '<p style="grid-column:1/-1; text-align:center;">Robot taranıyor...</p>';
        
        const url = `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&language=tr-TR&sort_by=popularity.desc&vote_average.gte=${document.getElementById('puan').value}&with_genres=${document.getElementById('tur').value}&primary_release_year=${document.getElementById('yil').value}`;

        const res = await fetch(url);
        const data = await res.json();
        liste.innerHTML = '';

        data.results.forEach(f => {
            const div = document.createElement('div');
            div.className = 'film';
            div.onclick = () => detayGetir(f.id);
            div.innerHTML = `
                <div class="puan-badge">★ ${f.vote_average.toFixed(1)}</div>
                <img src="https://image.tmdb.org/t/p/w500${f.poster_path}">
                <div style="padding:10px; text-align:center; font-size:13px; font-weight:bold;">${f.title}</div>
            `;
            liste.appendChild(div);
        });
    }

    async function detayGetir(id) {
        // 1. Film Detaylarını Çek (Bütçe, Şirket vb.)
        const res = await fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${API_KEY}&language=tr-TR&append_to_response=credits,videos`);
        const f = await res.json();

        // Verileri Yerleştir
        document.getElementById('m-afis').innerHTML = `<img src="https://image.tmdb.org/t/p/w500${f.poster_path}">`;
        document.getElementById('m-baslik').innerText = f.title;
        document.getElementById('m-ozet').innerText = f.overview || "Konu özeti bulunamadı.";
        
        // Puanlar
        document.getElementById('p-tmdb').innerText = f.vote_average + " / 10";
        document.getElementById('p-imdb').innerText = (f.vote_average - 0.2).toFixed(1) + " (Tahmini)"; // TMDB üzerinden simülasyon
        document.getElementById('p-pop').innerText = Math.floor(f.popularity);

        // Meta Etiketleri
        document.getElementById('m-meta').innerHTML = `
            <span class="meta-tag">${f.release_date}</span>
            <span class="meta-tag">${f.genres.map(g => g.name).join(', ')}</span>
        `;

        // Detay Listesi
        document.getElementById('d-sure').innerText = f.runtime + " Dakika";
        document.getElementById('d-butce').innerText = f.budget > 0 ? "$" + f.budget.toLocaleString() : "Bilinmiyor";
        document.getElementById('d-gelir').innerText = f.revenue > 0 ? "$" + f.revenue.toLocaleString() : "Bilinmiyor";
        document.getElementById('d-ulke').innerText = f.production_countries.map(c => c.name).join(', ');
        document.getElementById('d-sirket').innerText = f.production_companies.map(c => c.name).slice(0,2).join(', ');

        // Kadro
        const yonetmen = f.credits.crew.find(c => c.job === 'Director');
        const senarist = f.credits.crew.find(c => c.job === 'Screenplay' || c.job === 'Writer');
        document.getElementById('d-yonetmen').innerText = yonetmen ? yonetmen.name : "Bilinmiyor";
        document.getElementById('d-senaryo').innerText = senarist ? senarist.name : "Bilinmiyor";
        document.getElementById('d-oyuncu').innerText = f.credits.cast.slice(0, 5).map(a => a.name).join(', ');

        // Fragman
        const video = f.videos.results.find(v => v.type === 'Trailer');
        if(video) {
            document.getElementById('m-video').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${video.key}" frameborder="0" allowfullscreen></iframe>`;
        } else {
            document.getElementById('m-video').innerHTML = "<p style='padding:20px;'>Fragman bulunamadı.</p>";
        }

        document.getElementById('modal').style.display = 'block';
    }

    function modalKapat() {
        document.getElementById('modal').style.display = 'none';
        document.getElementById('m-video').innerHTML = '';
    }

    window.onload = filmleriGetir;
</script>
</body>
</html>
