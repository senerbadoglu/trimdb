<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film Robotu | Geli≈ümi≈ü Filtreleme</title>
    <style>
        :root { --main-color: #f5c518; --bg-black: #0b0b0b; --card-bg: #1a1a1a; --filter-bg: #222; }
        body { background-color: var(--bg-black); color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; overflow-x: hidden; }
        
        /* Header */
        header { background: #121212; padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 1000; }
        .logo { color: var(--main-color); font-weight: 900; font-size: 24px; text-decoration: none; border: 2px solid var(--main-color); padding: 5px 10px; border-radius: 5px; }
        .header-tools { display: flex; align-items: center; gap: 15px; }
        .dot { width: 15px; height: 15px; border-radius: 50%; cursor: pointer; border: 1px solid #fff; }

        /* Film Robotu Paneli */
        .robot-container { background: #181818; padding: 20px 5%; border-bottom: 1px solid #333; }
        .robot-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .robot-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        
        .filter-box { background: var(--filter-bg); padding: 10px; border-radius: 8px; border: 1px solid #333; position: relative; }
        .filter-box label { display: block; font-size: 11px; color: #888; margin-bottom: 5px; text-transform: uppercase; }
        .filter-box select { width: 100%; background: transparent; color: white; border: none; outline: none; font-size: 14px; cursor: pointer; appearance: none; }
        
        /* Arama Butonu */
        .search-btn { background: var(--main-color); color: black; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; width: 100%; }
        .search-btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* Film Kartlarƒ± */
        .grid { padding: 25px 5%; display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 25px; }
        .card { background: var(--card-bg); border-radius: 12px; overflow: hidden; border: 1px solid #222; transition: 0.4s; position: relative; }
        .card:hover { transform: translateY(-10px); border-color: var(--main-color); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .card img { width: 100%; height: 280px; object-fit: cover; cursor: pointer; }
        .info { padding: 15px; }
        .info h3 { margin: 0 0 8px 0; font-size: 14px; height: 38px; overflow: hidden; line-height: 1.4; }
        .badge { background: rgba(0,0,0,0.7); color: var(--main-color); padding: 3px 7px; border-radius: 4px; font-size: 12px; font-weight: bold; position: absolute; top: 10px; right: 10px; }
        .trailer-btn { background: #e50914; color: white; border: none; width: 100%; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 5px; }

        /* Modal & Load More */
        .load-more { text-align: center; padding: 40px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; }
        .modal-content { width: 90%; max-width: 900px; margin: 5% auto; position: relative; }
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; background: #000; border-radius: 15px; overflow: hidden; }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        .close { position: absolute; right: -40px; top: -40px; font-size: 40px; color: white; cursor: pointer; }

        @media (max-width: 768px) { 
            .close { right: 0; top: -50px; } 
        }
        
        /* TELEFON ƒ∞√áƒ∞N EK D√úZENLEME */
        @media (max-width: 600px) {
            .robot-grid {
                grid-template-columns: 1fr !important;
            }
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)) !important;
                gap: 15px !important;
            }
            .card img {
                height: 220px !important;
            }
            .info h3 {
                font-size: 13px !important;
                height: 35px !important;
            }
        }
    </style>
</head>
<body>

<header>
    <a href="#" class="logo" onclick="location.reload()">FILM-ROBOTU</a>
    <div class="header-tools">
        <div class="dot" style="background: #f5c518;" onclick="setTheme('#f5c518')"></div>
        <div class="dot" style="background: #ff4757;" onclick="setTheme('#ff4757')"></div>
        <div class="dot" style="background: #1e90ff;" onclick="setTheme('#1e90ff')"></div>
        <select id="main-lang" onchange="applyFilters()" style="background:#333; color:white; border:none; border-radius:4px; padding:2px 5px;">
            <option value="tr-TR">TR</option>
            <option value="en-US">EN</option>
        </select>
    </div>
</header>

<div class="robot-container">
    <div class="robot-title">üîç Film Robotu</div>
    <div class="robot-grid">
        <div class="filter-box">
            <label>T√ºrler</label>
            <select id="f-genre">
                <option value="">Hepsi</option>
                <option value="28">Aksiyon</option>
                <option value="12">Macera</option>
                <option value="35">Komedi</option>
                <option value="27">Korku</option>
                <option value="878">Bilim Kurgu</option>
                <option value="18">Dram</option>
            </select>
        </div>
        <div class="filter-box">
            <label>Yƒ±llar</label>
            <select id="f-year">
                <option value="">Hepsi</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2010">2010s</option>
                <option value="2000">2000s</option>
            </select>
        </div>
        <div class="filter-box">
            <label>IMDb Puanƒ±</label>
            <select id="f-rating">
                <option value="0">Hepsi</option>
                <option value="8">8.0+ √úzeri</option>
                <option value="7">7.0+ √úzeri</option>
                <option value="5">5.0+ √úzeri</option>
            </select>
        </div>
        <div class="filter-box">
            <label>Sƒ±ralama</label>
            <select id="f-sort">
                <option value="popularity.desc">Pop√ºlerlik</option>
                <option value="vote_average.desc">Puan (Y√ºksek)</option>
                <option value="primary_release_date.desc">Tarih (Yeni)</option>
            </select>
        </div>
        <button class="search-btn" onclick="applyFilters()">Robotu √áalƒ±≈ütƒ±r</button>
    </div>
</div>

<div class="grid" id="movie-grid"></div>

<div class="load-more">
    <button class="search-btn" style="width: 200px;" onclick="loadMore()">Daha Fazla Film</button>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeV()">&times;</span>
        <div id="v-box" class="video-wrapper"></div>
    </div>
</div>

<script>
    const API_KEY = '5157610ea853936f008717feb19e6a9f';
    let page = 1;

    function setTheme(c) { 
        document.documentElement.style.setProperty('--main-color', c); 
    }

    async function applyFilters() {
        page = 1;
        document.getElementById('movie-grid').innerHTML = '';
        fetchFromRobot();
    }

    async function fetchFromRobot() {
        const genre = document.getElementById('f-genre').value;
        const year = document.getElementById('f-year').value;
        const rating = document.getElementById('f-rating').value;
        const sort = document.getElementById('f-sort').value;
        const lang = document.getElementById('main-lang').value;
        
        const grid = document.getElementById('movie-grid');
        
        // Y√úKLENƒ∞YOR YAZISI
        if (page === 1) {
            grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:40px; color:var(--main-color)">‚è≥ Filmler y√ºkleniyor...</div>';
        }

        let url = `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&language=${lang}&page=${page}&sort_by=${sort}&vote_average.gte=${rating}`;
        
        if(genre) url += `&with_genres=${genre}`;
        if(year) url += `&primary_release_year=${year}`;

        try {
            const res = await fetch(url);
            const data = await res.json();
            
            // BO≈û Lƒ∞STE KONTROL√ú
            if (page === 1 && data.results.length === 0) {
                grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:40px">üé¨ Film bulunamadƒ±! Filtreleri deƒüi≈ütirmeyi deneyin.</div>';
                return;
            }
            
            render(data.results);
        } catch (e) { 
            console.log("Hata:", e);
            // HATA MESAJI
            if (page === 1) {
                grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:40px; color:#ff4757">‚ùå Filmler y√ºklenirken hata olu≈ütu. ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin.</div>';
            }
        }
    }

    function render(list) {
        // BO≈û Lƒ∞STE KONTROL√ú 2
        if (list.length === 0 && page === 1) {
            document.getElementById('movie-grid').innerHTML = 
                '<div style="grid-column:1/-1; text-align:center; padding:40px; color:white">üé¨ Film bulunamadƒ±! Filtreleri deƒüi≈ütirmeyi deneyin.</div>';
            return;
        }
        
        const grid = document.getElementById('movie-grid');
        // ƒ∞LK Y√úKLEME DEƒûƒ∞LSE ESKƒ∞ Fƒ∞LMLERƒ∞ Sƒ∞LME
        if (page === 1) {
            grid.innerHTML = '';
        }
        
        list.forEach(m => {
            if(!m.poster_path) return;
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <div class="badge">‚òÖ ${m.vote_average.toFixed(1)}</div>
                <img src="https://image.tmdb.org/t/p/w500${m.poster_path}" onclick="openV(${m.id})">
                <div class="info">
                    <h3>${m.title}</h3>
                    <button class="trailer-btn" onclick="openV(${m.id})">Fragmanƒ± ƒ∞zle</button>
                </div>`;
            grid.appendChild(div);
        });
    }

    function loadMore() { 
        page++; 
        fetchFromRobot(); 
    }

    async function openV(id) {
        const lang = document.getElementById('main-lang').value;
        const res = await fetch(`https://api.themoviedb.org/3/movie/${id}/videos?api_key=${API_KEY}&language=${lang}`);
        let data = await res.json();
        let v = data.results.find(x => x.type === 'Trailer') || data.results[0];
        
        if(v) {
            document.getElementById('v-box').innerHTML = `<iframe src="https://www.youtube.com/embed/${v.key}?autoplay=1" allowfullscreen></iframe>`;
            document.getElementById('modal').style.display = 'block';
            history.pushState({m:true}, "");
        } else { 
            alert("Bu film i√ßin fragman bulunamadƒ±."); 
        }
    }

    function closeV() { 
        document.getElementById('modal').style.display = 'none'; 
        document.getElementById('v-box').innerHTML = '';
    }

    window.onpopstate = () => closeV();
    window.onload = () => fetchFromRobot();
</script>
</body>
</html>
